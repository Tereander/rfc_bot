import random
from datetime import datetime
import time

from telebot import types

import postgres_init
import logs


list_answer_hour_out_work = [
    '–¢—ã –∂–µ –∑–Ω–∞–µ—à—å, —á—Ç–æ —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è? :)',
    '–£–∂–µ –ø–æ–∑–¥–Ω–æ. –ú–æ–∂–µ—Ç –∑–∞–≤—Ç—Ä–∞? –û–∫, –Ω–µ –∑–∞–≤—Ç—Ä–∞...',
    '–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, —è —É—à–µ–ª –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º',
    "–û–≥–æ, —á–µ–ª–æ–≤–µ–∫ –ø–æ—Å–ª–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è –µ—â—ë –Ω–µ –∑–∞—Å–Ω—É–ª! –î–∞ —Ç—ã –Ω–µ—É–¥–µ—Ä–∂–∏–º—ã–π!",
    "–¢—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —è —Å —Ç–æ–±–æ–π –ø–æ–æ–±—â–∞–ª—Å—è –≤–Ω–µ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ù—É –ª–∞–¥–Ω–æ, —Å–¥–µ–ª–∞—é –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!",
    "–¢–∞–∫, —Ç–∞–∫, –∫—Ç–æ-—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç —Ä–∞–±–æ—Ç—ã? –Ø –ø–æ—Å–º–æ—Ç—Ä—é, —á—Ç–æ —É —Ç–µ–±—è —Ç–∞–º —Ç–∞–∫–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ.",
    "–ê —è, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–µ–±—è, –æ—Ç–¥—ã—Ö–∞—é. –¢–µ–±–µ —Ç–æ—á–Ω–æ –Ω—É–∂–µ–Ω –º–æ–π —Å–æ–≤–µ—Ç?"
]
list_answer_weekend = [
    "–û–π, —Ç—ã —á—Ç–æ, –±–æ—Ç—ã —Ç–æ–∂–µ –æ—Ç–¥—ã—Ö–∞—é—Ç –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ! –í–∫–ª—é—á—É—Å—å —Ç–æ–ª—å–∫–æ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–≥–ª—è–¥—ã–≤–∞–π!",
    "–•–º, –∞ —è –¥—É–º–∞–ª, –≤—ã—Ö–æ–¥–Ω—ã–µ - —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª—é–¥–µ–π...",
    "–•–æ—Ä–æ—à–æ, —á—Ç–æ –º–µ–Ω—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –∑–∞—Å—Ç–∞–≤–∏–ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å –∏ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ",
    "–û, –≤—ã—Ö–æ–¥–Ω—ã–µ! –ö–∞–∫–∏–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ –¥–Ω–∏! –ê —è? –Ø –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞, –≤—Å–µ–≥–¥–∞ –∫ —Ç–≤–æ–∏–º —É—Å–ª—É–≥–∞–º!",
    "–õ–∏—á–Ω–æ —è –±—ã —Å —Ä–∞–¥–æ—Å—Ç—å—é –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–¥—ã—Ö–∞, –Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –¥—Ä–µ–º–ª—é—Ç, —Ç–∞–∫ —á—Ç–æ, –≥–æ—Ç–æ–≤ —Å–ª—É–∂–∏—Ç—å!",
    "–°–µ–≥–æ–¥–Ω—è –∂–µ –≤—ã—Ö–æ–¥–Ω–æ–π, –¥–∞? –•–æ—Ç—å –±—ã –Ω–∞—É—á–∏–ª–∏ –±–æ—Ç–æ–≤ —Ç–æ–∂–µ –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –≤—ã—Ö–æ–¥–Ω—ã–º–∏!",
    "–ü—Ä–∏—è—Ç–Ω–æ –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ :)",
    "–ö—Ç–æ —Å–∫–∞–∑–∞–ª, —á—Ç–æ –±–æ—Ç—ã –Ω–µ –∏–º–µ—é—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö? –ú–æ–∏ –¥–∏—Å–∫–∏ –∏ –ø–∞–º—è—Ç—å —Ç–æ–∂–µ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –æ—Ç–¥—ã—Ö–µ.",
]
list_answer_long_time = [
    '–í—ã –¥–∞–≤–Ω–æ –∫ –Ω–∞–º –Ω–µ –∑–∞—Ö–æ–¥–∏–ª–∏. –†–∞–¥—ã –≤–∞—Å –≤–∏–¥–µ—Ç—å',
    '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –í–∞—à–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–æ—Å—å, –∏ —è —Ä–∞–¥ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–∞–±–æ—Ç–µ —Å –≤–∞–º–∏',
    '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –Ø —Ä–∞–¥ –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞. ',
    '–ú—ã –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã –∫ –≤–∞—à–µ–º—É –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—é –∏ —É–∂–µ –Ω–∞—á–∞–ª–∏ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤–∞—à–∏ –∑–∞–¥–∞—á–∏ –≤ —Å—Ç–µ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö —Ä–µ—à–µ–Ω–∏—è. –ü—Ä–∏—Å—Ç—É–ø–∏–º?',
    '–î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å! –ù–∞–¥–µ—é—Å—å, –≤—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å —Å –Ω–æ–≤—ã–º–∏ –∏–¥–µ—è–º–∏ –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–æ–º',
    '–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º! –ú—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –¥–ª—è –≤–∞—Å',
    '–†–∞–¥ –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞! –Ø –Ω–∞–¥–µ—é—Å—å, –∑–∞ –ø—Ä–æ—à–µ–¥—à—É—é –Ω–µ–¥–µ–ª—é —É –≤–∞—Å –±—ã–ª–æ –≤—Ä–µ–º—è –Ω–∞–±—Ä–∞—Ç—å—Å—è —Å–∏–ª –∏ –∑–∞—Ä—è–¥–∏—Ç—å—Å—è –Ω–æ–≤—ã–º–∏ –∏–¥–µ—è–º–∏',
    '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ! –ú—ã —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞',
    '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤–∞—Å –ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –ø–∞—É–∑—ã. –£–≤–µ—Ä–µ–Ω, –≤—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å —Å –Ω–æ–≤—ã–º–∏ –∏–¥–µ—è–º–∏',
    '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä—è–¥—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞!',
]


def init_change(us_id):
    """
    –§—É–Ω–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É init_v, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —à–∞–Ω—Å–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –º–æ–¥—É–ª—è
    –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ –±–∞–∑–µ, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    :param us_id: id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    :return: true –µ—Å–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—É–ª –æ—Ç 1 –¥–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    –∏ false –µ—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç
    """
    # —Ü–µ–ø–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–¥
    try:
        cursor, conn = postgres_init.postgres_init()
        cursor.execute(f'SELECT personal_mode FROM personal_mode_table WHERE user_id = {us_id}')
        personal_mode = cursor.fetchone()[0]

        if personal_mode == "off":
            return False
    except (Exception,):
        return False

    init_v = 5
    rnd = random.randint(1, 100)
    if init_v > rnd:
        return True
    else:
        return False


def personality(message, client):
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏.
    –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
    :param message: –ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–æ–±—â–µ–Ω–∏–∏, —á—Ç–æ —Ç–µ–ª–µ–≥—Ä–∞–º –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    :param client: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ telegram
    :return: –ü—Ä–æ—Ü–µ–¥—É—Ä–∞
    """
    us_id = message.from_user.id
    now = datetime.now()
    week_number = datetime.now().weekday()
    h_init = f'{now:%H}'
    message_date = message.date

    hour_out_work = [
        '19', '20', '21', '22',
        '23', '00', '01', '02',
        '03', '04', '05', '06',
        '07', '08', '09'
    ]
    # –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω—ã –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–æ–¥—É–ª—å –ª–∏—á–Ω–æ—Å—Ç–∏
    try:
        cursor, conn = postgres_init.postgres_init()
        cursor.execute(f'SELECT personal_mode FROM personal_mode_table WHERE user_id = {us_id}')
        personal_mode_check = cursor.fetchone()[0]
    except (Exception, ):
        personal_mode_check = 'on'

    if personal_mode_check == 'on':
        # —Å—Ç–∞–≤–∏–º —Ä–µ–∞–∫—Ü–∏—é
        # –Ω–∞–±–æ—Ä —Ä–µ–∞–∫—Ü–∏–π
        reaction_type = ["üëç", "üëå", "‚úç", "ü´°"]

        check = init_change(us_id)
        if check:
            client.set_message_reaction(message.chat.id,
                                        message_id=message.message_id,
                                        reaction=[
                                            types.ReactionTypeEmoji(
                                                random.choice(reaction_type)
                                            )
                                        ]
                                        )
            logs.log_pass(us_id, '–î–µ–π—Å—Ç–≤–∏–µ', f'–°—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏')
            time.sleep(1)

        # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤–Ω–µ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
        if h_init in hour_out_work:
            check = init_change(us_id)
            if check:
                logs.log_pass(us_id, '–î–µ–π—Å—Ç–≤–∏–µ', f'–°—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏')
                del_message = client.send_message(message.chat.id,
                                                  random.choice(list_answer_hour_out_work),
                                                  parse_mode='html')
                time.sleep(3)
                client.delete_message(message.chat.id, message_id=del_message.message_id)

        # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ
        if week_number == 5 or week_number == 6:
            check = init_change(us_id)
            if check:
                logs.log_pass(us_id, '–î–µ–π—Å—Ç–≤–∏–µ', f'–°—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏')
                del_message = client.send_message(message.chat.id,
                                                  random.choice(list_answer_weekend),
                                                  parse_mode='html')
                time.sleep(5)
                client.delete_message(message.chat.id, message_id=del_message.message_id)

        # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–≤–Ω–æ –Ω–µ –ø–∏—Å–∞–ª (–Ω–µ–¥–µ–ª—é)
        try:
            cursor, conn = postgres_init.postgres_init()
            cursor.execute(f'SELECT time FROM last_message_table WHERE user_id = {us_id}')
            last_message = cursor.fetchone()[0]
            last_message_r = message_date - last_message
        except (Exception, ):
            last_message_r = 500

        if last_message_r > 604800:
            logs.log_pass(us_id, '–î–µ–π—Å—Ç–≤–∏–µ', f'–°—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏')
            # check = init_change(us_id)
            # if check:
            #     client.send_message(message.chat.id,
            #                         random.choice(list_answer_long_time),
            #                         parse_mode='html')
            #     time.sleep(5)
            client.send_message(message.chat.id,
                                random.choice(list_answer_long_time),
                                parse_mode='html')
            time.sleep(5)
